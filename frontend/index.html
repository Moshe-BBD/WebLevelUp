<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<title>Spider Flip Book</title>
		<link rel="stylesheet" href="styles.css" />
		<script src="app.js"></script>
	</head>
	<body>
		<header id="top-nav">
			<img src="images/spiderLogo.png" alt="Logo" id="logo" />
			<h1 id="nav-title">SPIDERPEDIA</h1>
			<nav class="nav-right">
				<p id="nav-username"></p>
				<a id="login-btn" href="/login">
					<img
						src="images/githubLogo.png"
						alt="GitHub Logo"
						class="github-icon"
					/>
					Login
				</a>
				<a id="logout-btn" href="/logout" style="display: none">Logout</a>
			</nav>
			<div class="sort-options">
				<label for="sort">Sort by:</label>
				<select id="sort">
					<option value="default">Default Order</option>
					<option value="asc">Name Ascending</option>
					<option value="desc">Name Descending</option>
				</select>
			</div>
		</header>

		<section id="book-content" style="display: none">
			<input type="checkbox" id="checkbox-cover" />
			<main class="book">
				<section class="cover">
					<label for="checkbox-cover">
						<img src="images/spiderPediaBookCover.png" alt="Cover Image" />
					</label>
				</section>
				<section class="back-cover"></section>
			</main>
			<span class="arrow left-arrow" onclick="prevPage()"></span>
			<span class="arrow right-arrow" onclick="nextPage()"></span>
		</section>

		<script>
			document.addEventListener("DOMContentLoaded", function () {
				const IMAGE_BASE_URL =
					"https://spiderpedia-bucket.s3.eu-west-1.amazonaws.com/";
				let currentPage = 0;
				const arrows = document.querySelectorAll(".arrow");

				document.getElementById("sort").addEventListener("change", function () {
					fetchSpidersInfo().then((data) => {
						if (data) {
							const sortedData = sortData(data, this.value);
							displaySpiders(sortedData);
						}
					});
				});

				function fetchSpidersInfo() {
					const apiUrl =
						"http://ec2-3-250-137-103.eu-west-1.compute.amazonaws.com:5000/api/spiders-info";
					return fetch(apiUrl).then((response) => response.json());
				}

				function sortData(data, sortOrder) {
					if (sortOrder === "asc") {
						return data.sort((a, b) =>
							a.spiderName.localeCompare(b.spiderName)
						);
					} else if (sortOrder === "desc") {
						return data.sort((a, b) =>
							b.spiderName.localeCompare(a.spiderName)
						);
					}
					return data;
				}

				function displaySpiders(data) {
					const book = document.querySelector(".book");
					const existingPages = document.querySelectorAll(".page");
					existingPages.forEach((page) => page.remove());

					data.forEach((spider, index) => {
						const page = document.createElement("article");
						page.classList.add("page");
						page.innerHTML = `
                        <input type="checkbox" id="checkbox-page${index + 1}" />
                        <section class="front-page">
                            <h2>${spider.spiderName}</h2>
                            <img src="${IMAGE_BASE_URL}${
							spider.spiderImage
						}" alt="${spider.spiderName}" class="spider-image"> 
                            <p>${spider.facts || "No fact available"}</p>
                            <label class="next" for="checkbox-page${
															index + 1
														}"></label>
                        </section>
                        <section class="back-page">
                            <label class="prev" for="checkbox-page${
															index + 1
														}"></label>
                        </section>
                    `;
						book.insertBefore(page, document.querySelector(".back-cover"));
					});

					showPage(0);
					showArrows();
				}

				function showPage(pageIndex) {
					const pages = document.querySelectorAll(".page");
					pages.forEach((page, index) => {
						page.style.display = index === pageIndex ? "block" : "none";
					});
					currentPage = pageIndex;
				}

				function showArrows() {
					arrows.forEach((arrow) => (arrow.style.display = "inline-block"));
				}

				function hideArrows() {
					arrows.forEach((arrow) => (arrow.style.display = "none"));
				}

				function nextPage() {
					if (currentPage < document.querySelectorAll(".page").length - 1) {
						showPage(currentPage + 1);
					}
				}

				function prevPage() {
					if (currentPage > 0) {
						showPage(currentPage - 1);
					}
				}

				// Initially fetch and display spiders
				fetchSpidersInfo().then((data) => displaySpiders(data));
			});
		</script>
	</body>
</html>
